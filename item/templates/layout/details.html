{% extends 'layout/basic.html' %}
{% load static %}
{% block content %}
    <head>

        <title>Details</title>
        <style type="text/css">
            #b1 {
                width: 95%;
                margin: 0 auto;
                padding: 0 10%;
            }

            .space {
                height: 150px;
            }

            .spaces {
                height: 50px;
            }

            img {
                border: 5px solid #b2bbbe;
            }

            .media-body {
                width: 95%;
                margin: 0 auto;
                padding: 0 5%;
                background-color: rgba(235, 232, 217, 0.51);
            }

            #p {
                position: absolute;
                bottom: -75px;
            }

            #search {
                height: 150px;
            }

            .input-group {
                width: 900px;
                margin: 0 auto;
            }
        </style>
    </head>
    <body>


    </div>
    <div id="search">
        <div class="input-group">
            <input type="text" class="form-control input-lg"><span class="input-group-addon btn btn-primary">搜索</span>
        </div>
    </div>
    <div id="b1" class="media">
        <div class="media-left">
            <a href="#">
                <img class="media-object" src="/static/images/{{ item_detail.img_index }}" alt="..." width="450px"
                     height="600px">
            </a>
        </div>
        <div class="media-body">
            <div class="spaces">

            </div>
            <h4 class="media-heading"><font size="5">{{ item_detail.gname }}</font></h4><br/><br/><br/>
            <h4 class="media-heading"><font size="4">{{ item_detail.intro_txt }}</font></h4><br/><br/><br/>
            <h4 class="media-heading"><font size="4">卖家信息：</font>{{ item_detail.userid }}</h4>
            <p id="p">
                <button id="btnFavorite" data-id=0 class="btn btn-primary" role="button">收藏</button>
            </p>
            <div class="spaces">

            </div>
        </div>
    </div>
    <div class="space">

    </div>
{% endblock %}
{% block js %}
    <script>
    var item_id = {{ item_detail.id }};
     var user_id = {{ user_info.id }};
    {#  $('#btnFavorite').data('id', 1)#}
    {##}
    {#console.log($('#btnFavorite').data('id'))#}
        yesornot()

        btnFavorite_click()
       function yesornot(){
            $.ajax({
                            {#请求的路由地址#}
                            url: "/item/isfavorite/",
                            type: "GET",
                            data: {

                                item_id: item_id,
                                user_id: user_id,
                            },
                            dataType: "JSON",
                            success: function (res) {
                                if (res.status) {
                                    console.log(res)
                                    $('#btnFavorite').data('id', 1)
                                    $('#btnFavorite').text('已经收藏')

                                }
                                else{
                                    console.log(res)
                                    $('#btnFavorite').data('id', 0)
                                    $('#btnFavorite').text('收藏')
                                }

                            }

                        })
                    }




        function btnFavorite_click() {
            $('#btnFavorite').click(function () {
                console.log($(this).data('id'))
                    dataid=$(this).data('id')
                    {#获取userid、itemid#}
                    if (dataid===0) {
                        $.ajax({
                            {#请求的路由地址#}
                            url: "/item/click_favorite/",
                            type: "GET",
                            data: {

                                item_id: item_id,
                                user_id: user_id,
                            },
                            dataType: "JSON",
                            success: function (res) {
                                if (res.status) {
                                    $(this).data('id', 1)
                                    yesornot()
                                }
                            }

                        })
                    }
                    else{
                              $.ajax({
                            {#请求的路由地址#}
                            url: "/item/cancel_favorite/",
                            type: "GET",
                            data: {

                                item_id: item_id,
                                user_id: user_id,
                            },
                            dataType: "JSON",
                            success: function (res) {
                                if (res.status) {
                                    $(this).data('id', 0)
                                    yesornot()
                                }
                            }

                        })


                    }

                }
            )
        }
    </script>
{% endblock %}
</body>
</html>